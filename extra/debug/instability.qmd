---
title: Testing instability
date: 2023-06-30
author: Ewan Carr
editor_options: 
  chunk_output_type: console
---

```{r}
library(pmsims)
library(tidyverse)
library(furrr)
library(future.apply)
plan(multisession, workers = 20)

n_reps <- c(100, 200, 500, 1000)
sample_sizes <- map(n_reps, \(r) {
  print(r)
  future_replicate(
    100,
    simulate_binary(
      signal_parameters = 10,
      baseline_prob = 0.1,
      large_sample_performance = 0.8,
      minimum_threshold = 0.05,
      min_sample_size = 100,
      max_sample_size = 5000,
      n_reps = r
    )$min_n
  )
})
```

```{r}
d <- tibble(n_reps, sample_sizes) |>
  mutate(min = map_dbl(sample_sizes, min),
         max = map_dbl(sample_sizes, max),
         median = map_dbl(sample_sizes, median))
```
