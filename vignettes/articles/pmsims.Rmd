---
title: "Getting started with pmsims"
---

```{r}
#| label: setup
#| include: false
knitr::opts_chunk$set(
  fig.path = "man/figures/",
  collapse = TRUE,
  comment = "#>",
  fig.width = 6, fig.height = 4,
  warning = FALSE,
  message = FALSE
)
```

## What pmsims does

**pmsims** estimates the **minimum sample size** needed to develop a
prediction model to achieve a target level of performance **with
assurance**. Rather than relying on simple rules of thumb or closed‑form
formulae, pmsims uses **simulation** to:

-   Generate synthetic datasets that reflect your target setting
    (outcome type, prevalence or $R^2$, signal vs. noise predictors);
-   Fit a specified **model** (e.g., logistic regression or linear
    regression);
-   Evaluate a chosen **performance metric** (e.g., calibration slope,
    AUC); and
-   Trace a **learning curve** of performance as the training size
    increases.

![](workflow.png)
```{=html}
<div style="text-align:center;">
  <img src="workflow.png" alt="A figure showing the package workflow." width="80%" />
</div>
```


The recommended design objective is **assurance**: the **smallest** $n$
such that a high proportion of repeated studies (e.g., 80%) meet the
target performance. In pmsims, this is implemented via the **20th
percentile** of the simulated performance distribution at each $n$.

## Required inputs at a glance

There are three wrapper functions for binary, continuous, and survival
outcomes, respectively:

- `simulate_binary()`
- `simulate_continuous()`
- `simulate_survival()`

All three functions share the same basic structure. The table below
lists the key inputs.

```{=html}
<table style="width:100%; border-collapse:collapse; table-layout:fixed;">
  <colgroup>
    <col style="width:220px;">
    <col style="width:70px;">
    <col style="width:70px;">
    <col style="width:170px;">
    <col style="width:50%;">
  </colgroup>
  <thead>
    <tr>
      <th style="text-align:left; padding:8px; border-bottom:1px solid #ddd;">Argument</th>
      <th style="text-align:left; padding:8px; border-bottom:1px solid #ddd;">Applies to</th>
      <th style="text-align:center; padding:8px; border-bottom:1px solid #ddd;">Req</th>
      <th style="text-align:left; padding:8px; border-bottom:1px solid #ddd;">Default</th>
      <th style="text-align:left; padding:8px; border-bottom:1px solid #ddd;">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><code>signal_parameters</code></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;">all</td>
      <td style="text-align:center; padding:8px; border-bottom:1px solid #f0f0f0;">✓</td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;">—</td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><em>(int)</em> Number of <strong>true signal</strong> predictors associated with the outcome.</td>
    </tr>
    <tr>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><code>noise_parameters</code></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;">all</td>
      <td style="text-align:center; padding:8px; border-bottom:1px solid #f0f0f0;"></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><code>0</code></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><em>(int)</em> Number of <strong>noise</strong> predictors unrelated to the outcome.</td>
    </tr>
    <tr>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><code>predictor_type</code></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;">all</td>
      <td style="text-align:center; padding:8px; border-bottom:1px solid #f0f0f0;"></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><code>"continuous"</code></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><em>(chr)</em> Type of simulated predictors (<code>"continuous"</code> or <code>"binary"</code>).</td>
    </tr>
    <tr>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><code>binary_predictor_prevalence</code></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;">all</td>
      <td style="text-align:center; padding:8px; border-bottom:1px solid #f0f0f0;"></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><code>NULL</code></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><em>(num 0–1)</em> Prevalence for binary predictors (used only if <code>predictor_type = "binary"</code>).</td>
    </tr>
    <tr>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><code>outcome_prevalence</code></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;">binary only</td>
      <td style="text-align:center; padding:8px; border-bottom:1px solid #f0f0f0;">✓</td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;">—</td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><em>(num 0–1)</em> Target prevalence of the binary outcome.</td>
    </tr>
    <tr>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><code>large_sample_cstatistic</code></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;">binary only</td>
      <td style="text-align:center; padding:8px; border-bottom:1px solid #f0f0f0;">✓</td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;">—</td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><em>(num 0–1)</em> Expected <strong>C-statistic</strong> for a very large training sample.</td>
    </tr>
    <tr>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><code>large_sample_rsquared</code></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;">continuous only</td>
      <td style="text-align:center; padding:8px; border-bottom:1px solid #f0f0f0;">✓</td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;">—</td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><em>(num 0–1)</em> Expected R<sup>2</sup> for a very large training sample.</td>
    </tr>
    <tr>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><code>large_sample_cindex</code></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;">survival only</td>
      <td style="text-align:center; padding:8px; border-bottom:1px solid #f0f0f0;">✓</td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;">—</td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><em>(num 0–1)</em> Expected <strong>concordance index</strong> for a very large training sample.</td>
    </tr>
    <tr>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><code>model</code></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;">all</td>
      <td style="text-align:center; padding:8px; border-bottom:1px solid #f0f0f0;"></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><code>"glm"</code> / <code>"lm"</code> / <code>"coxph"</code></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><em>(chr)</em> Model used for fitting (e.g. logistic, linear, or Cox).</td>
    </tr>
    <tr>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><code>metric</code></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;">all</td>
      <td style="text-align:center; padding:8px; border-bottom:1px solid #f0f0f0;"></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><code>"calibration_slope"</code></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><em>(chr)</em> <strong>Performance metric</strong> used to estimate the <strong>minimum required sample size</strong> (e.g. calibration slope, R<sup>2</sup>, C-statistic).</td>
    </tr>
    <tr>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><code>minimum_acceptable_performance</code></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;">all</td>
      <td style="text-align:center; padding:8px; border-bottom:1px solid #f0f0f0;">✓</td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;">—</td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><em>(num)</em> <strong>Minimum acceptable performance</strong> in the <strong>units of the chosen metric</strong> (e.g. calibration slope ≥ 0.9).</td>
    </tr>
    <tr>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><code>n_reps_total</code></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;">all</td>
      <td style="text-align:center; padding:8px; border-bottom:1px solid #f0f0f0;">✓</td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><code>1000</code></td>
      <td style="padding:8px; border-bottom:1px solid #f0f0f0;"><em>(int)</em> Total number of simulation replications.</td>
    </tr>
    <tr>
      <td style="padding:8px;"><code>mean_or_assurance</code></td>
      <td style="padding:8px;">all</td>
      <td style="text-align:center; padding:8px;"></td>
      <td style="padding:8px;"><code>"assurance"</code></td>
      <td style="padding:8px;"><em>(chr)</em> Criterion for summarising results; <code>"assurance"</code> recommended.</td>
    </tr>
  </tbody>
</table>
```

> Notes:
>
> - The engine automatically tunes the data generator so the
>   chosen model reaches the specified **large‑sample performance**
>   (C‑statistic or $R^2$) on very large samples.
> - For reproducibility, set a random seed (`set.seed()`).

## Installation

```{r}
# install.packages("remotes")
# remotes::install_github("pmsims-package/pmsims")
library(pmsims)
```

## Binary-outcome example

We target the smallest *n* that meets the **assurance** criterion.

```{r}
#| eval: false
set.seed(123)

binary_example <- simulate_binary(
  signal_parameters = 15,
  noise_parameters  = 0,
  predictor_type = "continuous",
  binary_predictor_prevalence = NULL,
  outcome_prevalence = 0.20,
  large_sample_cstatistic = 0.80,
  model = "glm",
  metric = "calibration_slope",
  minimum_acceptable_performance = 0.90,
  n_reps_total = 1000,
  mean_or_assurance = "assurance"
)

binary_example
```

Plot the estimated learning curve and identified sample size:

```{r}
#| eval: false
plot(binary_example)
```

## Continuous-outcome example

```{r}
#| eval: false
continuous_example <- simulate_continuous(
  signal_parameters = 15,
  noise_parameters = 0,
  predictor_type = "continuous",
  large_sample_rsquared = 0.50,
  model = "lm",
  metric = "calibration_slope",
  minimum_acceptable_performance = 0.90,
  n_reps_total = 1000,
  mean_or_assurance = "assurance"
)

continuous_example
```

```{r}
#| eval: false
plot(continuous_example)
```

## Session info

```{r}
sessionInfo()
```
